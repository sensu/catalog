## Overview

<!-- Sensu Integration description; supports markdown -->

The GCP Storage Monitoring integration collects Google [Cloud Storage] metrics from the [Cloud Monitoring API] and alerts on invalid request rate.

<!-- Provide a high level overview of the integration contents (e.g. checks, filters, mutators, handlers, assets, etc) -->

This integration includes the following Sensu resources:

* `gcp-{PROJECT_ID}-storage-metrics` [check]
* `sensu/gcp-monitoring-check:0.2.0` [asset]

## Dashboards

<!-- List of compatible dashboards w/ screenshots (supports png, jpeg, and gif images; relative paths only; e.g. `![](img/dashboard-1.png)` )-->

<!-- This integration is compatible with the [{{dashboard_name}}][{{dashboard_link}}] (included w/ [Sensu Plus][sensu-plus]). -->

<!-- ![](img/dashboard.png) -->

The GCP Storage Monitoring integration does not have compatible dashboards.

## Setup

<!-- Sensu Integration setup instructions, including Sensu agent configuration and external component configuration -->
<!-- EXAMPLE: what configuration (if any) is required in a third-party service to enable monitoring? -->

1. [Enable the Monitoring API].

1. Get the Google Cloud Storage [project ID][Listing projects].

1. Get the Google Cloud service account key in JSON string format.

   The GCP Storage Monitoring integration accepts [service account] authentication for the [Cloud Monitoring API]. Service accounts must have an IAM profile with read access to the [Cloud Monitoring API].

   If the check from this integration will run on a Sensu agent that is installed on a GCP compute instance that uses a service account with read access to the Cloud Monitoring API, you do not need to provide an authentication token. In this case, the Sensu agent environment will be prepopulated with service account credentials.

   **Optional**: If you want to use a Sensu [secret] to represent the service account key, you will need the secret name when you install this integration.

1. Decide which Sensu agents should execute the `gcp-{PROJECT_ID}-storage-metrics` check. You will need the agent [subscription] names when you install this integration.

1. If you want to use a Sensu [pipeline] to process GCP Storage Monitoring integration data, you will need the pipeline names when you install this integration.

   You can configure separate pipelines for alerts, metrics, and incident management.

## Plugins

<!-- Links to any Sensu Integration dependencies (i.e. Sensu Plugins) -->

The GCP Storage Monitoring integration uses the following Sensu [plugins]:

- [sensu/gcp-monitoring-check][gcp-monitoring-check-bonsai] ([GitHub][gcp-monitoring-check-github])

## Alerts

<!-- List of all alerts generated by this integration. -->

The GCP Storage Monitoring integration produces the following alerts, which should be processed by an alert or incident management [pipeline]:

**Invalid Request Rate**

Generates a WARNING event when `invalid_request_rate` is greater than a user-configurable value (default 0).

## Metrics

<!-- List of all metrics or events collected by this integration. -->

The GCP Storage Monitoring integration collects several [metrics] from [Cloud Storage], which are listed in the table below. For a description of each metric, read the Google Cloud [storage metrics] documentation.

Metric name | Tags
----------- | ----
`gcp_storage_api_request_rate` | `response_code`, `method`
`gcp_storage_network_received_bytes_rate` | `response_code`, `method`
`gcp_storage_sent_bytes_rate` | `response_code`, `method`
`gcp_storage_authz_acl_operations_rate` | `acl_operation`

## Reference Documentation

<!-- Please provide links to any relevant reference documentation to help users learn more and/or troubleshoot this integration; specifically including any third-party software documentation. -->

* [Token substitution] (Sensu documentation): the GCP Storage Monitoring integration supports Sensu tokens for variable substitution with data from Sensu entities
* [Cloud Monitoring API] (Google Cloud documentation)
* [Cloud Storage] (Google Cloud documentation)


<!-- Links -->
[check]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/checks/
[asset]: https://docs.sensu.io/sensu-go/latest/plugins/assets/
[subscription]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/subscriptions/
[subscriptions]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/subscriptions/
[agents]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/agent/
[annotation]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/agent/#agent-annotations
[plugins]: https://docs.sensu.io/sensu-go/latest/plugins/
[metrics]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/metrics/
[handler]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-process/handlers/
[pipeline]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-process/pipelines/
[secret]: https://docs.sensu.io/sensu-go/latest/operations/manage-secrets/secrets/
[secrets]: https://docs.sensu.io/sensu-go/latest/operations/manage-secrets/secrets/
[Token substitution]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/tokens/
[sensu-plus]: https://sensu.io/features/analytics
[gcp-monitoring-check-bonsai]: https://bonsai.sensu.io/assets/sensu/gcp-monitoring-check
[gcp-monitoring-check-github]: https://github.com/sensu/gcp-monitoring-check
[Cloud Storage]: https://cloud.google.com/storage/
[Cloud Monitoring API]: https://cloud.google.com/monitoring/api/v3
[service accounts]: https://cloud.google.com/docs/authentication/production
[authentication supported]: https://cloud.google.com/monitoring/api/enable-api#authorizing-api-v3
[Enable the Monitoring API]: https://cloud.google.com/monitoring/api/enable-api
[Listing projects]: https://cloud.google.com/resource-manager/docs/creating-managing-projects#listing_projects
[storage metrics]: https://cloud.google.com/monitoring/api/metrics_gcp#gcp-storage
