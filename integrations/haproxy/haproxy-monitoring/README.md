## Overview

<!-- Sensu Integration description; supports markdown -->

The HAProxy Monitoring integration collects metrics for a HAProxy instance and outputs the metrics in Prometheus format.

<!-- Provide a high level overview of the integration contents (e.g. checks, filters, mutators, handlers, assets, etc) -->

This integration provides the following Sensu resources:

- `haproxy-metrics` [check]
- `sensu/haproxy-check:0.1.2` [asset]

### Dashboards

<!-- List of supported dashboards w/ screenshots (supports png, jpeg, and gif images; relative paths only; e.g. `![](img/dashboard-1.png)` )-->

The HAProxy Monitoring integration does not have compatible dashboards.

## Setup

<!-- Sensu Integration setup instructions, including Sensu agent configuration and external component configuration -->
<!-- EXAMPLE: what configuration (if any) is required in a third-party service to enable monitoring? -->

1. Get the paths and URLs for the HAProxy stats sockets and stats pages for metrics collection. You will need the paths and URLs when you install this integration.

   The HAProxy Monitoring integraton supports UNIX socket paths like `/var/run/socket` and `unix:///var/run/socket` as well as HTTP URLs like `http://haproxy.box/stats;csv`. This integration also supports TLS.

1. Decide which Sensu agents should execute the `haproxy-metrics` check. You will need the agent [subscription] names when you install this integration.

1. If you want to use a Sensu [pipeline] to process HAProxy Monitoring integration data, you will need the pipeline name when you install this integration.

1. **Optional** Configure custom paths and URLs.

   The HAProxy Monitoring integration uses the stats socket paths and stats page URLs you specify for all agents.

   To override the parameters and specify custom paths and URLs on a per-agent basis, add the `haproxy_url` [annotation] to the Sensu [agent] configuration file (`agent.yml`). Use a comma-separated list for multiple values.

   <details><summary><strong>Example: Custom path and URL configuration</strong></summary>

   ```yaml
   annotations:
     haproxy_url: "{CUSTOM_PATH},{CUSTOM_URL}"
   ```

   </details>
   <br>

## Plugins

<!-- Links to any Sensu Integration dependencies (i.e. Sensu Plugins) -->

The HAProxy Monitoring integration uses the following Sensu [plugins]:

- [sensu/haproxy-check:0.1.2][sensu-haproxy-check-bonsai] ([GitHub][sensu-haproxy-check-github])

## Alerts

<!-- List of all alerts generated by this integration. -->

The HAProxy Monitoring integration does not produce events that should be processed by an alert or incident management pipeline.

## Metrics

<!-- List of all metrics or events collected by this integration. -->

The HAProxy Monitoring integration collects the following [metrics]:

Metric name | Description
----------- | -----------
`haproxy_active_servers` | Number of active servers
`haproxy_backup_servers` | Number of backup servers
`haproxy_bin` | Bytes in
`haproxy_bout` | Bytes out
`haproxy_chkfail` | Health check failed
`haproxy_ctime` | Connect time for haproxy_ctime
`haproxy_dreq` | Requests denied (security)
`haproxy_dresp` | Response denied (security)
`haproxy_econ` | Number of connection errors
`haproxy_ereq` | Number of request errors
`haproxy_eresp` | Number of response errors
`haproxy_http_response_1xx` | Response status 1xx (info)
`haproxy_http_response_2xx` | Response status 2xx (success)
`haproxy_http_response_3xx` | Response status 3xx (redirect)
`haproxy_http_response_4xx` | Response status 4xx (failed)
`haproxy_http_response_5xx` | Response status 5xx (internal error)
`haproxy_http_response_other` | Response status (other)
`haproxy_qcur` | Current queued requests
`haproxy_qmax` | Maximum queued requests
`haproxy_qtime` | Queue time
`haproxy_rate` | Session rate
`haproxy_rtime` | Response time
`haproxy_scur` | Session current
`haproxy_slim` | Session limit
`haproxy_smax` | Session max
`haproxy_ttime` | Average time
`haproxy_weight` | Weight
`haproxy_wredis` | Warning redispatched
`haproxy_wretr` | Warning retries

## Reference Documentation

<!-- Please provide links to any relevant reference documentation to help users learn more and/or troubleshoot this integration. -->

* [Statistics and monitoring] (HAProxy Community Edition Management Guide)


<!-- Links -->
[check]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/checks/
[asset]: https://docs.sensu.io/sensu-go/latest/plugins/assets/
[subscription]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/subscriptions/
[agent]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/agent/
[annotation]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/agent/#agent-annotations
[plugins]: https://docs.sensu.io/sensu-go/latest/plugins/
[metrics]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/metrics/
[handler]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-process/handlers/
[tokens]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/tokens/
[sensu-plus]: https://sensu.io/features/analytics
[sensu-haproxy-check-bonsai]: https://bonsai.sensu.io/assets/sensu/haproxy-check
[sensu-haproxy-check-github]: https://github.com/sensu/haproxy-check
[Statistics and monitoring]: https://cbonte.github.io/haproxy-dconv/2.4/management.html#9
