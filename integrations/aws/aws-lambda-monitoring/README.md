## Overview

<!-- Sensu Integration description; supports markdown -->

The AWS Lambda Monitoring integration collects [AWS Lambda] metrics from [AWS CloudWatch] and sends alerts for various Lamda conditions.

<!-- Provide a high level overview of the integration contents (e.g. checks, filters, mutators, handlers, assets, etc) -->

This integration includes the following Sensu resources:

* `aws-{AWS_PROFILE}-lambda-metrics` [check]
* `sensu/sensu-cloudwatch-check:0.2.0` [asset]

## Dashboards

<!-- List of compatible dashboards w/ screenshots (supports png, jpeg, and gif images; relative paths only; e.g. `![](img/dashboard-1.png)` )-->

<!-- This integration is compatible with the [{{dashboard_name}}][{{dashboard_link}}] (included w/ [Sensu Plus][sensu-plus]). -->

<!-- ![](img/dashboard.png) -->

The AWS Lambda Monitoring integration does not have compatible dashboards.

## Setup

<!-- Sensu Integration setup instructions, including Sensu agent configuration and external component configuration -->
<!-- EXAMPLE: what configuration (if any) is required in a third-party service to enable monitoring? -->

1. Confirm that you have access to [AWS CloudWatch APIs].
   
   The AWS Lambda Monitoring integration requires read-only access to AWS CloudWatch (e.g. `arn:aws:iam::aws:policy/CloudWatchReadOnlyAccess`).

1. Get AWS authentication credentials.
   
   The AWS Lambda Monitoring integration accepts all forms of AWS authentication supported by the [AWS CLI]:

   - AWS credential profile
   - AWS access key ID + AWS secret access key
   - [EC2 IAM instance profile]

   Avoid providing an AWS credential profile, access key ID, or secret access key in production environments. We suggest an alternative form of AWS authentication, such as EC2 IAM instance profiles.

   If the check from this integration will run on a Sensu agent installed on an EC2 instance whose EC2 IAM instance profile contains `arn:aws:iam::aws:policy/CloudWatchReadOnlyAccess`, you do not need to provide an AWS credential profile, access key ID, or secret access key.

   **Optional**: If you want to use Sensu [secrets] to represent the AWS profile name, access key ID, or secret access key, you will need the secret names when you install this integration.

1. Decide which Sensu agents should execute the `aws-{AWS_REGION}-lambda-metrics` check. You will need the agent subscription names when you install this integration.

1. If you want to use a Sensu [pipeline] to process AWS Lambda Monitoring integration data, you will need the pipeline names when you install this integration.

   You can configure separate pipelines for alerts, incident management, and metrics.

## Plugins

<!-- Links to any Sensu Integration dependencies (i.e. Sensu Plugins) -->

The AWS Lambda Monitoring integration uses the following Sensu [plugins]:

- [sensu/sensu-cloudwatch-check][sensu-cloudwatch-check-bonsai] ([GitHub][sensu-cloudwatch-check-github])

## Alerts

<!-- List of all alerts generated by this integration. -->

The AWS Lambda Monitoring integration produces the following events that should be processed by an alert or incident management pipeline:

**Errors**

Generates a WARNING event when `aws_lambda_errors` is greater than a user-configurable maximum value (default 0).

**Throttles**

Generates a WARNING event when `aws_lambda_throttles` is greater than a user-configurable maximum value (default 0).

**DeadLetterErrors**

Generates a WARNING event when `aws_lambda_dead_letter_errors` is greater than a user-configurable maximum value (default 0).

## Metrics

<!-- List of all metrics or events collected by this integration. -->

The AWS Lambda Monitoring integration collects dozens of CloudWatch AWS Lambda metrics (i.e. `AWS/Lambda` metrics), which are listed in the table below. For a description of each metric, read [Types of metrics] and [Important metrics for CloudWatch].

Metric name | Tags
----------- | ----
`aws_lambda_unreserved_concurrent_executions_average` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_unreserved_concurrent_executions_maximum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_unreserved_concurrent_executions_minimum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_concurrent_executions_average` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_concurrent_executions_maximum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_concurrent_executions_minimum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_provisioned_concurrent_executions_average` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_provisioned_concurrent_executions_maximum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_provisioned_concurrent_executions_minimum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_provisioned_concurrency_utilization_average` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_provisioned_concurrency_utilization_maximum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_provisioned_concurrency_utilization_minimum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_invocations` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_errors` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_dead_letter_errors` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_destination_delivery_failures` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_throttles` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_provisioned_concurrency_invocations` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_provisioned_concurrency_spillover_invocations` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_post_runtime_extensions_duration_average` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_post_runtime_extensions_duration_maximum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_post_runtime_extensions_duration_minimum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_iterator_age_average` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_iterator_age_maximum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_iterator_age_minimum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_offset_lag_average` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_offset_lag_maximum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_offset_lag_minimum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_duration_average` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_duration_maximum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`
`aws_lambda_duration_minimum` | `FunctionName`, `Resource`, `Region`, `ExecutedVersion`

## Reference Documentation

<!-- Please provide links to any relevant reference documentation to help users learn more and/or troubleshoot this integration; specifically including any third-party software documentation. -->

* [Token substitution] (Sensu documentation): the AWS Lambda Monitoring integration supports Sensu tokens for variable substitution with data from Sensu entities
* [AWS Lambda] (AWS documentation)
* [Amazon CloudWatch API Reference][AWS CloudWatch APIs] (AWS documentation)


<!-- Links -->
[check]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/checks/
[asset]: https://docs.sensu.io/sensu-go/latest/plugins/assets/
[subscription]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/subscriptions/
[subscriptions]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/subscriptions/
[agents]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/agent/
[annotation]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/agent/#agent-annotations
[plugins]: https://docs.sensu.io/sensu-go/latest/plugins/
[metrics]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/metrics/
[handler]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-process/handlers/
[pipeline]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-process/pipelines/
[secret]: https://docs.sensu.io/sensu-go/latest/operations/manage-secrets/secrets/
[secrets]: https://docs.sensu.io/sensu-go/latest/operations/manage-secrets/secrets/
[Token substitution]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/tokens/
[sensu-plus]: https://sensu.io/features/analytics
[sensu-cloudwatch-check-bonsai]: https://bonsai.sensu.io/assets/sensu/sensu-cloudwatch-check
[sensu-cloudwatch-check-github]: https://github.com/sensu/sensu-cloudwatch-check
[Types of metrics]: https://docs.aws.amazon.com/lambda/latest/dg/monitoring-metrics.html#monitoring-metrics-types
[Important metrics for CloudWatch]: https://docs.aws.amazon.com/lambda/latest/operatorguide/important-metrics.html
[AWS Lambda]: https://aws.amazon.com/lambda/
[AWS CloudWatch]: https://aws.amazon.com/cloudwatch/
[AWS CLI]: https://aws.amazon.com/cli/
[EC2 IAM instance profile]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html
[AWS CloudWatch APIs]: https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/Welcome.html
