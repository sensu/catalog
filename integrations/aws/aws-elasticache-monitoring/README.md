## Overview

<!-- Sensu Integration description; supports markdown -->

The AWS ElastiCache Monitoring integration collects [Amazon ElastiCache] metrics from [AWS CloudWatch], and alerts on various threshold conditions.

<!-- Provide a high level overview of the integration contents (e.g. checks, filters, mutators, handlers, assets, etc) -->

This integration includes the following Sensu resources:

* `aws-{AWS_REGION}-elasticache-metrics` [check]
* `sensu/sensu-cloudwatch-check:0.2.0` [asset]

## Dashboards

<!-- List of compatible dashboards w/ screenshots (supports png, jpeg, and gif images; relative paths only; e.g. `![](img/dashboard-1.png)` )-->

<!-- This integration is compatible with the [{{dashboard_name}}][{{dashboard_link}}] (included w/ [Sensu Plus][sensu-plus]). -->

<!-- ![](img/dashboard.png) -->

The AWS ElastiCache Monitoring integration does not have compatible dashboards.

## Setup

<!-- Sensu Integration setup instructions, including Sensu agent configuration and external component configuration -->
<!-- EXAMPLE: what configuration (if any) is required in a third-party service to enable monitoring? -->

1. Confirm that you have access to [AWS CloudWatch APIs].
   
   The AWS ElastiCache Monitoring integration requires read-only access to AWS CloudWatch (e.g. `arn:aws:iam::aws:policy/CloudWatchReadOnlyAccess`).

1. Get AWS authentication credentials.
   
   The AWS ElastiCache Monitoring integration accepts all forms of AWS authentication supported by the [AWS CLI]:

   - AWS credential profile
   - AWS access key ID + AWS secret access key
   - [EC2 IAM instance profile]

   Avoid providing an AWS credential profile, access key ID, or secret access key in production environments. We suggest an alternative form of AWS authentication, such as EC2 IAM instance profiles.

   If the check from this integration will run on a Sensu agent installed on an EC2 instance whose EC2 IAM instance profile contains `arn:aws:iam::aws:policy/CloudWatchReadOnlyAccess`, you do not need to provide an AWS credential profile, access key ID, or secret access key.

   **Optional**: If you want to use Sensu [secrets] to represent the AWS profile name, access key ID, or secret access key, you will need the secret names when you install this integration.

1. Decide which Sensu agents should execute the `aws-{AWS_REGION}-elasticache-metrics` check. You will need the agent subscription names when you install this integration.

1. If you want to use a Sensu [pipeline] to process AWS ElastiCache Monitoring integration data, you will need the pipeline names when you install this integration.

   You can configure separate pipelines for alerts, incident management, and metrics.

## Plugins

<!-- Links to any Sensu Integration dependencies (i.e. Sensu Plugins) -->

The AWS ElastiCache Monitoring integration uses the following Sensu [plugins]:

- [sensu/sensu-cloudwatch-check][sensu-cloudwatch-check-bonsai] ([GitHub][sensu-cloudwatch-check-github])

## Alerts

<!-- List of all alerts generated by this integration. -->

The AWS ElastiCache Monitoring integration produces the following events that should be processed by an alert or incident management pipeline:

**CpuUtilization**

Generates a WARNING event when `aws_elasticache_cpu_utilization_maximum` is greater than a user-configurable minimum value (default 90).

## Metrics

<!-- List of all metrics or events collected by this integration. -->

The AWS ElastiCache Monitoring integration collects a subset of available [CloudWatch AWS ElastiCache metrics] (i.e. `AWS/ElastiCache` metrics), which are listed in the table below. For a description of each metric, read [Metrics for Memcached] and [Metrics for Redis].

Metric name | Tags
----------- | ----
`aws_elasticache_curr_volatile_items` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_active_defrag_hits_average` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_active_defrag_hits_maximum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_active_defrag_hits_minimum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_database_memory_usage_percentage_average` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_database_memory_usage_percentage_maximum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_database_memory_usage_percentage_minimum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_new_connections` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_freeable_memory_average` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_freeable_memory_maximum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_freeable_memory_minimum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_network_bytes_in` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_is_master` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_cpu_utilization_average` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_cpu_utilization_maximum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_cpu_utilization_minimum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_engine_cpu_utilization_average` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_engine_cpu_utilization_maximum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_engine_cpu_utilization_minimum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_replication_lag_average` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_replication_lag_maximum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_replication_lag_minimum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_bytes_used_for_cache_average` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_bytes_used_for_cache_maximum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_bytes_used_for_cache_minimum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_key_based_cmds` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_cache_hits` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_reclaimed` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_network_packets_in` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_master_link_health_status` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_evictions` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_set_type_cmds` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_save_in_progress` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_network_bytes_out` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_cache_misses` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_replication_bytes_average` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_replication_bytes_maximum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_replication_bytes_minimum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_curr_items` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_database_memory_usage_counted_for_evict_percentage_average` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_database_memory_usage_counted_for_evict_percentage_maximum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_database_memory_usage_counted_for_evict_percentage_minimum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_swap_usage_average` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_swap_usage_maximum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_swap_usage_minimum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_network_packets_out` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_memory_fragmentation_ratio_average` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_memory_fragmentation_ratio_maximum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_memory_fragmentation_ratio_minimum` | `CacheClusterId`, `CacheNodeId`
`aws_elasticache_curr_connections` | `CacheClusterId`, `CacheNodeId`

## Reference Documentation

<!-- Please provide links to any relevant reference documentation to help users learn more and/or troubleshoot this integration; specifically including any third-party software documentation. -->

* [Token substitution] (Sensu documentation): the AWS ElastiCache Monitoring integration supports Sensu tokens for variable substitution with data from Sensu entities
* [Amazon ElastiCache][ElastiCache] (AWS documentation)
* [Amazon CloudWatch API Reference][AWS CloudWatch APIs] (AWS documentation)


<!-- Links -->
[check]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/checks/
[asset]: https://docs.sensu.io/sensu-go/latest/plugins/assets/
[subscription]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/subscriptions/
[subscriptions]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/subscriptions/
[agents]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/agent/
[annotation]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/agent/#agent-annotations
[plugins]: https://docs.sensu.io/sensu-go/latest/plugins/
[metrics]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/metrics/
[handler]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-process/handlers/
[pipeline]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-process/pipelines/
[secret]: https://docs.sensu.io/sensu-go/latest/operations/manage-secrets/secrets/
[secrets]: https://docs.sensu.io/sensu-go/latest/operations/manage-secrets/secrets/
[Token substitution]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/tokens/
[sensu-plus]: https://sensu.io/features/analytics
[{{dashboard-link}}]: #
[sensu-cloudwatch-check-bonsai]: https://bonsai.sensu.io/assets/sensu/sensu-cloudwatch-check
[sensu-cloudwatch-check-github]: https://github.com/sensu/sensu-cloudwatch-check
[ElastiCache]: https://aws.amazon.com/elasticache/
[AWS CloudWatch]: https://aws.amazon.com/cloudwatch/
[AWS CLI]: https://aws.amazon.com/cli/
[EC2 IAM instance profile]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html
[AWS CloudWatch APIs]: https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/Welcome.html
[Metrics for Memcached]: https://docs.aws.amazon.com/AmazonElastiCache/latest/mem-ug/CacheMetrics.Memcached.html
[Metrics for Redis]: https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/CacheMetrics.Redis.html
