---
api_version: catalog/v1
type: Integration
metadata:
  namespace: splunk
  name: splunk-events
spec:
  class: supported
  provider: events
  display_name: Splunk Events
  short_description: Process Sensu events as log data in Splunk
  supported_platforms:
    - darwin
    - linux
    - windows
  tags:
    - splunk
    - events
  contributors:
    - "@sensu"
    - "@nixwiz"
  prompts:
    - type: section
      title: Splunk Endpoint Configuration
    - type: markdown
      body: |
        This integration forwards Sensu event data to a [Splunk Universal Forwarder] (recommended) or directly to a Splunk indexer.

        Enter the Splunk endpoint host and port number, as well as the maximum number of connections to keep alive in the connection pool.

        **NOTE**: If Splunk Universal Forwarders are installed directly on Sensu backend nodes (or Kubernetes pods), use `localhost` or `127.0.0.1` as the host.

        [Splunk Universal Forwarder]: https://docs.splunk.com/Documentation/Forwarder/latest/Forwarder/Abouttheuniversalforwarder
    - type: question
      name: host
      required: true
      input:
        type: string
        title: Host
        description: >-
          Enter the endpoint host
        default: localhost
    - type: question
      name: port
      required: true
      input:
        type: integer
        title: Port
        description: >-
          Enter the endpoint port number
    - type: question
      name: connections
      input:
        type: integer
        title: Max number of connections
        description: >-
          Enter the maximum number of connections to keep alive in the connection pool (enter `0` to disable connection pooling)
        default: 5
  resource_patches:
    - resource:
        api_version: pipeline/v1
        type: TCPStreamHandler
        name: splunk-events
      patches:
        - path: /spec/address
          op: replace
          value: "[[host]]:[[port]]"
        - path: /spec/max_connections
          op: replace
          value: "[[connections]]"
  post_install:
    - type: section
      title: Success
    - type: markdown
      body: |
        You enabled the Splunk Events integration.

        Sensu will stream events and metrics data from checks that reference the `splunk-events` pipeline to Splunk at `tcp://[[ host ]]:[[ port ]]`.

        ```yaml
        spec:
          pipelines:
            - api_version: core/v2
              type: Pipeline
              name: splunk-events
        ```